<!-- settings.html - Modern Settings Panel for SimBudget -->
<div class="settings-container">

  <!-- ============= ACCOUNT BAR ============= -->
  <div class="account-bar">
    <div class="account-info">
      <span class="account-email" id="userEmail">Loading...</span>
      <span id="trialStatus" class="license-badge" style="display:none;">Loading...</span>
    </div>
    <a href="https://ko-fi.com/s/4b62acb528" target="_blank" class="support-link">
      <span class="free-label">Simplify Budget is Free</span> · Tap to support ☕
    </a>
  </div>

  <!-- ============= BUDGET SPREADSHEET ============= -->
  <div class="settings-card">
    <div class="card-header">
      <h3>Budget Spreadsheet</h3>
      <p class="card-subtitle">Spreadsheet template required to store all your transactions. Stored in your Google Drive.</p>
    </div>
    <div class="card-content">
      <div class="spreadsheet-actions">
        <button id="newDatabase" class="action-pill action-new">
          <i class="material-icons">add_circle_outline</i>
          <span data-translate="new_database">New Template</span>
          <span class="pill-help" onclick="event.stopPropagation(); showSpreadsheetHelp('new')">?</span>
        </button>

        <button id="pickSheetFile" class="action-pill action-pick" onclick="SettingsPage.openGooglePicker()">
          <i class="material-icons">folder_open</i>
          <span data-translate="select_existing">Pick Existing</span>
          <span class="pill-help" onclick="event.stopPropagation(); showSpreadsheetHelp('pick')">?</span>
        </button>

        <button id="disconnectDatabase" class="action-pill action-disconnect">
          <i class="material-icons">link_off</i>
          <span data-translate="disconnect">Disconnect</span>
          <span class="pill-help" onclick="event.stopPropagation(); showSpreadsheetHelp('disconnect')">?</span>
        </button>
      </div>

      <div id="sheetStatus" class="connection-status">
        <i class="material-icons status-icon">cloud_off</i>
        <span data-translate="no_sheet_selected">No sheet connected</span>
      </div>
    </div>
  </div>

  <!-- Data Tools Row - Hidden -->
  <div style="display: none;">
    <button id="checkDataHealth" onclick="SettingsPage.checkDataHealth()">Check</button>
    <button id="fixTransactionIds" onclick="SettingsPage.fixTransactionIds()">Fix IDs</button>
  </div>

  <!-- ============= DISPLAY SETTINGS ============= -->
  <div class="settings-card" data-section="display">
    <div class="card-header">
      <h3 data-translate="display_settings">Display Settings</h3>
    </div>
    <div class="card-content">
      <div class="settings-grid">
        <!-- Language -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="language">Language</span>
          </div>
          <div class="setting-control">
            <select id="languageSelector" class="modern-select">
              <option value="en">English</option>
              <option value="es">Español</option>
              <option value="de">Deutsch</option>
              <option value="fr">Français</option>
              <option value="ms">Bahasa Melayu</option>
              <option value="tr">Türkçe</option>
              <option value="pt">Português</option>
              <option value="ja">日本語</option>
            </select>
          </div>
        </div>

        <!-- Base Currency -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="currency">Base Currency</span>
          </div>
          <div class="setting-control">
            <select id="currencySelector" class="modern-select">
              <!-- Options added by JavaScript -->
            </select>
          </div>
        </div>

        <!-- Display Currency -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="display_currency">Display Currency</span>
          </div>
          <div class="setting-control">
            <select id="displayCurrencySelector" class="modern-select">
              <!-- Options added by JavaScript -->
            </select>
          </div>
        </div>

        <!-- Exchange Rate -->
        <div class="setting-item" id="exchangeRateRow" style="display: none;">
          <div class="setting-info">
            <span class="setting-label" id="exchangeRateLabel">Exchange Rate</span>
          </div>
          <div class="setting-control">
            <input type="number" id="exchangeRateInput" class="modern-input" placeholder="1.00" step="0.01" min="0.01">
          </div>
        </div>

        <!-- Show Decimals -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="show_decimals">Show Decimals</span>
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="showDecimals">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Show Category Totals -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="show_category_totals">Category Totals in Calendar</span>
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="showCategoryTotals">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Show Currency Symbol -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="show_currency_symbol_grid">Currency Symbol in Calendar</span>
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="showCurrencySymbolGrid">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Default Net Worth Chart -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="default_networth_chart">Default Net Worth Chart</span>
          </div>
          <div class="setting-control">
            <select id="netWorthDefaultChart" class="modern-select">
              <option value="performance">Performance</option>
              <option value="timeline">Timeline</option>
              <option value="allocation">Allocation</option>
            </select>
          </div>
        </div>

        <!-- Dark Mode -->
        <div class="setting-item">
          <div class="setting-info">
            <span class="setting-label" data-translate="dark_mode">Dark Mode</span>
          </div>
          <div class="setting-control">
            <label class="toggle">
              <input type="checkbox" id="darkMode">
              <span class="toggle-slider"></span>
            </label>
          </div>
        </div>

        <!-- Date Format - Hidden -->
        <div class="setting-item" style="display:none">
          <div class="setting-info">
            <span class="setting-label" data-translate="date_format">Date Format</span>
          </div>
          <div class="setting-control">
            <select id="dateFormat" class="modern-select">
              <option value="MM/DD/YYYY">MM/DD/YYYY</option>
              <option value="DD/MM/YYYY">DD/MM/YYYY</option>
              <option value="YYYY-MM-DD">YYYY-MM-DD</option>
            </select>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Hidden Budget Preferences -->
  <div style="display: none">
    <input type="checkbox" id="showRemaining">
    <input type="checkbox" id="enableAlerts">
  </div>

  <!-- ============= STATUS FOOTER ============= -->
  <div id="settingsStatus" class="status-toast hidden"></div>

</div>

<style>
/* ============= MODERN SETTINGS STYLES ============= */

:root {
  --s-bg: #f2f2f7;
  --s-card: #ffffff;
  --s-border: #e5e5ea;
  --s-text: #1c1c1e;
  --s-text-secondary: #8e8e93;
  --s-accent: #007aff;
  --s-green: #34c759;
  --s-teal: #5ac8fa;
  --s-red: #ff3b30;
  --s-radius: 12px;
  --s-shadow: 0 1px 3px rgba(0,0,0,0.08);
}

/* Dark mode variables */
body.dark-mode {
  --s-bg: #000000;
  --s-card: #1c1c1e;
  --s-border: #38383a;
  --s-text: #ffffff;
  --s-text-secondary: #8e8e93;
}

/* ============= CONTAINER ============= */
.settings-container {
  max-width: 720px;
  margin: 0 auto;
  padding: 16px;
  min-height: 100%;
}

/* ============= ACCOUNT BAR ============= */
.account-bar {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 16px;
  background: var(--s-card);
  border-radius: var(--s-radius);
  margin-bottom: 16px;
  box-shadow: var(--s-shadow);
  flex-wrap: wrap;
  gap: 8px;
}

.account-info {
  display: flex;
  align-items: center;
  gap: 10px;
}

.account-email {
  font-size: 15px;
  font-weight: 600;
  color: var(--s-text);
}

.license-badge {
  font-size: 12px;
  padding: 3px 8px;
  border-radius: 20px;
  background: #e8f5e9;
  color: #2e7d32;
  font-weight: 500;
}

.license-badge.trial {
  background: #fff3e0;
  color: #e65100;
}

.license-badge.expired {
  background: #ffebee;
  color: #c62828;
}

.support-link {
  font-size: 13px;
  color: var(--s-text-secondary);
  text-decoration: none;
  transition: color 0.2s;
}

.support-link:hover {
  color: var(--s-accent);
}

.free-label {
  font-weight: 600;
  color: var(--s-text);
}

body.dark-mode .free-label {
  color: var(--s-text);
}

body.dark-mode .license-badge {
  background: rgba(46, 125, 50, 0.2);
}

body.dark-mode .license-badge.trial {
  background: rgba(230, 81, 0, 0.2);
}

body.dark-mode .license-badge.expired {
  background: rgba(198, 40, 40, 0.2);
}

/* ============= SETTINGS CARD ============= */
.settings-card {
  background: var(--s-card);
  border-radius: var(--s-radius);
  margin-bottom: 16px;
  box-shadow: var(--s-shadow);
  overflow: hidden;
}

.card-header {
  padding: 16px 16px 8px;
}

.card-header h3 {
  margin: 0;
  font-size: 13px;
  font-weight: 600;
  color: var(--s-text-secondary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.card-subtitle {
  margin: 6px 0 0;
  font-size: 13px;
  color: var(--s-text-secondary);
  line-height: 1.4;
}

.card-content {
  padding: 8px 16px 16px;
}

/* ============= SPREADSHEET ACTIONS ============= */
.spreadsheet-actions {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
  margin-bottom: 12px;
}

.action-pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 8px 14px;
  border-radius: 20px;
  font-size: 13px;
  font-weight: 600;
  border: none;
  cursor: pointer;
  transition: all 0.15s ease;
}

.action-pill i {
  font-size: 16px;
}

.action-pill .pill-help {
  display: inline-flex;
  align-items: center;
  justify-content: center;
  width: 16px;
  height: 16px;
  border-radius: 50%;
  background: rgba(255,255,255,0.3);
  font-size: 10px;
  font-weight: bold;
  margin-left: 2px;
  cursor: pointer;
  border: none;
  color: inherit;
}

.action-pill .pill-help:hover {
  background: rgba(255,255,255,0.5);
}

.action-new {
  background: var(--s-green);
  color: white;
}

.action-new:hover {
  background: #2db84d;
}

.action-pick {
  background: var(--s-accent);
  color: white;
}

.action-pick:hover {
  background: #0066d6;
}

.action-disconnect {
  background: var(--s-red);
  color: white;
}

.action-disconnect:hover {
  background: #e62e24;
}

.connection-status {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 10px 12px;
  background: var(--s-bg);
  border-radius: 8px;
  font-size: 13px;
  color: var(--s-text-secondary);
}

.connection-status .status-icon {
  font-size: 18px;
}

.connection-status.connected {
  background: #e8f5e9;
  color: #2e7d32;
}

.connection-status.connected .status-icon {
  color: #2e7d32;
}

body.dark-mode .connection-status {
  background: rgba(255,255,255,0.05);
}

body.dark-mode .connection-status.connected {
  background: rgba(46, 125, 50, 0.15);
}

/* ============= SETTINGS GRID ============= */
.settings-grid {
  display: flex;
  flex-direction: column;
}

.setting-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 0;
  border-bottom: 1px solid var(--s-border);
}

.setting-item:last-child {
  border-bottom: none;
}

.setting-info {
  flex: 1;
}

.setting-label {
  font-size: 15px;
  color: var(--s-text);
}

.setting-control {
  flex-shrink: 0;
}

/* ============= MODERN SELECT ============= */
.modern-select {
  appearance: none;
  padding: 8px 28px 8px 12px;
  font-size: 14px;
  color: var(--s-text-secondary);
  background: var(--s-bg);
  border: none;
  border-radius: 8px;
  cursor: pointer;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%238e8e93' d='M6 8L2 4h8z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 10px center;
  min-width: 120px;
}

.modern-select:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--s-accent);
}

body.dark-mode .modern-select {
  background-color: rgba(255,255,255,0.1);
  color: var(--s-text);
}

/* ============= MODERN INPUT ============= */
.modern-input {
  padding: 8px 12px;
  font-size: 14px;
  color: var(--s-text);
  background: var(--s-bg);
  border: none;
  border-radius: 8px;
  width: 80px;
  text-align: right;
}

.modern-input:focus {
  outline: none;
  box-shadow: 0 0 0 2px var(--s-accent);
}

body.dark-mode .modern-input {
  background: rgba(255,255,255,0.1);
  color: var(--s-text);
}

/* ============= TOGGLE SWITCH ============= */
.toggle {
  position: relative;
  display: inline-block;
  width: 51px;
  height: 31px;
}

.toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: #e9e9eb;
  border-radius: 31px;
  transition: 0.2s;
}

.toggle-slider::before {
  position: absolute;
  content: "";
  height: 27px;
  width: 27px;
  left: 2px;
  bottom: 2px;
  background-color: white;
  border-radius: 50%;
  transition: 0.2s;
  box-shadow: 0 2px 4px rgba(0,0,0,0.2);
}

.toggle input:checked + .toggle-slider {
  background-color: var(--s-green);
}

.toggle input:checked + .toggle-slider::before {
  transform: translateX(20px);
}

body.dark-mode .toggle-slider {
  background-color: #39393d;
}

/* ============= STATUS TOAST ============= */
.status-toast {
  position: fixed;
  bottom: 24px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 20px;
  background: var(--s-text);
  color: white;
  border-radius: 10px;
  font-size: 14px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  z-index: 1000;
  transition: opacity 0.2s, transform 0.2s;
}

.status-toast.hidden {
  opacity: 0;
  transform: translateX(-50%) translateY(20px);
  pointer-events: none;
}

.status-toast.success {
  background: var(--s-green);
}

.status-toast.error {
  background: var(--s-red);
}

/* ============= HELP DIALOG ============= */
.help-dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: rgba(0,0,0,0.4);
  display: flex;
  justify-content: center;
  align-items: center;
  z-index: 10000;
  backdrop-filter: blur(4px);
  padding: 20px;
  box-sizing: border-box;
}

.help-dialog {
  background: var(--s-card);
  border-radius: 14px;
  padding: 24px;
  max-width: 340px;
  width: 100%;
  box-shadow: 0 20px 60px rgba(0,0,0,0.3);
  max-height: 90vh;
  overflow-y: auto;
}

.help-dialog-large {
  max-width: 480px;
}

.help-dialog h3 {
  margin: 0 0 16px;
  font-size: 20px;
  font-weight: 600;
  color: var(--s-text);
}

.help-content p {
  margin: 0 0 12px;
  font-size: 14px;
  line-height: 1.6;
  color: var(--s-text-secondary);
}

.help-content p:last-child {
  margin-bottom: 0;
}

.help-section {
  margin-top: 20px;
  padding-top: 16px;
  border-top: 1px solid var(--s-border);
}

.help-section h4 {
  margin: 0 0 8px;
  font-size: 14px;
  font-weight: 600;
  color: var(--s-text);
}

.help-section p {
  margin: 0 0 8px;
  font-size: 13px;
  line-height: 1.5;
  color: var(--s-text-secondary);
}

.help-note {
  font-size: 12px !important;
  color: var(--s-text-secondary);
  opacity: 0.8;
}

.help-link {
  color: var(--s-accent);
  text-decoration: none;
  font-weight: 500;
}

.help-link:hover {
  text-decoration: underline;
}

.help-dialog > button {
  width: 100%;
  padding: 12px;
  margin-top: 20px;
  border: none;
  border-radius: 10px;
  background: var(--s-accent);
  color: white;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
}

.help-dialog > button:hover {
  background: #0066d6;
}

/* Dialog with multiple buttons */
.dialog-buttons {
  display: flex;
  gap: 12px;
  margin-top: 20px;
}

.dialog-btn {
  flex: 1;
  padding: 12px;
  border: none;
  border-radius: 10px;
  font-size: 15px;
  font-weight: 600;
  cursor: pointer;
  transition: background 0.15s;
}

.dialog-btn-cancel {
  background: var(--s-bg);
  color: var(--s-text);
}

.dialog-btn-cancel:hover {
  background: var(--s-border);
}

.dialog-btn-danger {
  background: var(--s-red);
  color: white;
}

.dialog-btn-danger:hover {
  background: #e62e24;
}

body.dark-mode .dialog-btn-cancel {
  background: rgba(255,255,255,0.1);
}

body.dark-mode .dialog-btn-cancel:hover {
  background: rgba(255,255,255,0.15);
}

/* ============= RESPONSIVE ============= */
@media (max-width: 600px) {
  .account-bar {
    flex-direction: column;
    align-items: flex-start;
  }

  .spreadsheet-actions {
    flex-direction: column;
  }

  .action-pill {
    width: 100%;
    justify-content: center;
  }

  .setting-item {
    flex-direction: column;
    align-items: flex-start;
    gap: 8px;
  }

  .setting-control {
    width: 100%;
  }

  .modern-select {
    width: 100%;
  }
}

/* Legacy class mappings for JS compatibility */
.toggle-input { display: none; }
.toggle-label { display: none; }
.settings-select { display: none; }
.trial-status-inline { display: none; }
</style>
